{"version":3,"file":"Client.js","names":["_reactNative","require","_Rollbar","_interopRequireDefault","_merge","e","__esModule","default","_classCallCheck","a","n","TypeError","NativeClient","NativeModules","RollbarReactNative","Client","config","_this","captureUncaughtExceptions","isNative","ErrorUtils","undefined","previousHandler","getGlobalHandler","setGlobalHandler","error","isFatal","options","captureUncaught","shouldSend","queued","captureUnhandledRejections","tracking","client","enable","allRejections","onUnhandled","id","onHandled","log","obj","extra","callback","rollbar","debug","info","warning","critical","setPerson","name","email","configure","person","clearPerson","Platform","OS","Configuration","setPlatform","init","toJSON","Rollbar","exports","_this2","releaseStage","enabledReleaseStages","includes","platform","payloadOptions","captureDeviceInfo","os","deviceAttributes","JSON","parse","merge","pkgData","payload","notifier","version"],"sources":["../src/Client.js"],"sourcesContent":["import { Platform, NativeModules } from 'react-native';\nimport Rollbar from './Rollbar';\nimport { merge } from './merge';\n\nconst NativeClient = NativeModules.RollbarReactNative;\n\nexport class Client {\n  constructor(config) {\n    this.isNative = Platform.OS !== 'web';\n\n    if (this.isNative) {\n      this.config = new Configuration(config);\n      this.config.setPlatform(Platform.OS);\n\n      if (NativeClient) {\n        NativeClient.init(this.config.toJSON());\n      }\n\n      this.rollbar = new Rollbar(this.config.toJSON());\n\n      this.captureUncaughtExceptions();\n      if (this.config.captureUnhandledRejections) {\n        this.captureUnhandledRejections();\n      }\n    } else {\n      this.rollbar = new Rollbar(config);\n    }\n  }\n\n  captureUncaughtExceptions = () => {\n    if (this.isNative && typeof ErrorUtils !== undefined) {\n      const previousHandler = ErrorUtils.getGlobalHandler();\n\n      ErrorUtils.setGlobalHandler((error, isFatal) => {\n        if (this.config.options.captureUncaught && this.config.shouldSend()) {\n          this.error(error, undefined, (queued) => {\n            if (previousHandler) {\n              previousHandler(error, isFatal);\n            }\n          });\n        } else if (previousHandler) {\n          previousHandler(error, isFatal);\n        }\n      });\n    }\n  }\n\n  captureUnhandledRejections = () => {\n    const tracking = require('promise/setimmediate/rejection-tracking');\n    const client = this;\n    tracking.enable({\n      allRejections: true,\n      onUnhandled: function(id, error) { client.error(error); },\n      onHandled: function() {}\n    });\n  }\n\n  log = (obj, extra, callback) => {\n    if (this.isNative && !this.config.shouldSend()) {\n      if (callback) {\n        callback(false);\n      }\n      return;\n    }\n\n    this.rollbar.log(obj, extra, callback);\n  }\n\n  debug = (obj, extra, callback) => {\n    return this.rollbar.debug(obj, extra, callback);\n  }\n\n  info = (obj, extra, callback) => {\n    return this.rollbar.info(obj, extra, callback);\n  }\n\n  warning = (obj, extra, callback) => {\n    return this.rollbar.warning(obj, extra, callback);\n  }\n\n  error = (obj, extra, callback) => {\n    return this.rollbar.error(obj, extra, callback);\n  }\n\n  critical = (obj, extra, callback) => {\n    return this.rollbar.critical(obj, extra, callback);\n  }\n\n  setPerson = (id, name, email) => {\n    this.rollbar.configure({}, {person: {id, name, email}});\n    if (NativeClient) {\n      NativeClient.setPerson({id, name, email});\n    }\n  }\n\n  clearPerson = () => {\n    this.rollbar.configure({}, {person: {}});\n    if (NativeClient) {\n      NativeClient.clearPerson();\n    }\n  }\n}\n\nclass Configuration {\n  constructor(options) {\n    const pkgData = require('../package.json');\n\n    // Ensure captureDeviceInfo is set before calling payloadOptions() below.\n    this.captureDeviceInfo = options.captureDeviceInfo === undefined ? false : options.captureDeviceInfo;\n\n    this.options = merge(options || {}, {\n      payload: merge(options.payload, this.payloadOptions()),\n      notifier: {\n        name: 'rollbar-react-native',\n        version: pkgData['version']\n      }\n    });\n  }\n\n  shouldSend = () => {\n    return !this.releaseStage ||\n      !this.enabledReleaseStages ||\n      this.enabledReleaseStages.includes(this.releaseStage);\n  }\n\n  setPlatform = (platform) => {\n    if (this.platform === undefined) {\n      this.platform = platform;\n    }\n  }\n\n  payloadOptions = () => {\n    if (!this.captureDeviceInfo) {\n      return {};\n    }\n\n    return {\n      client: {\n        os: this.deviceAttributes()\n      }\n    }\n  }\n\n  deviceAttributes = () => {\n    if (NativeClient) {\n      return JSON.parse(NativeClient.deviceAttributes());\n    } else {\n      return {};\n    }\n  }\n\n  toJSON = () => {\n    return merge(this.options, {\n      platform: this.platform\n    });\n  }\n}\n"],"mappings":"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","ignoreList":[]}