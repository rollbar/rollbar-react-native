{"version":3,"file":"Client.js","names":["NativeClient","NativeModules","RollbarReactNative","Client","config","captureUncaughtExceptions","isNative","ErrorUtils","undefined","previousHandler","getGlobalHandler","setGlobalHandler","error","isFatal","captureUncaught","shouldSend","queued","captureUnhandledRejections","tracking","require","client","enable","allRejections","onUnhandled","id","onHandled","log","obj","extra","callback","rollbar","debug","info","warning","critical","setPerson","name","email","configure","person","clearPerson","Platform","OS","Configuration","setPlatform","init","toJSON","ReactNativeRollbar","BrowserRollbar","options","releaseStage","enabledReleaseStages","includes","platform","payloadOptions","captureDeviceInfo","os","deviceAttributes","JSON","parse","merge","pkgData","payload","notifier","version"],"sources":["../src/Client.js"],"sourcesContent":["import { Platform, NativeModules } from 'react-native';\n\nimport ReactNativeRollbar from 'rollbar/src/react-native/rollbar';\nimport BrowserRollbar from 'rollbar';\n\nimport { merge } from './merge';\n\nconst NativeClient = NativeModules.RollbarReactNative;\n\nexport class Client {\n  constructor(config) {\n    this.isNative = Platform.OS !== 'web';\n\n    if (this.isNative) {\n      this.config = new Configuration(config);\n      this.config.setPlatform(Platform.OS);\n\n      if (NativeClient) {\n        NativeClient.init(this.config.toJSON());\n      }\n\n      this.rollbar = new ReactNativeRollbar(this.config.toJSON());\n\n      this.captureUncaughtExceptions();\n      if (this.config.captureUnhandledRejections) {\n        this.captureUnhandledRejections();\n      }\n    } else {\n      this.rollbar = new BrowserRollbar(config);\n    }\n  }\n\n  captureUncaughtExceptions = () => {\n    if (this.isNative && typeof ErrorUtils !== undefined) {\n      const previousHandler = ErrorUtils.getGlobalHandler();\n\n      ErrorUtils.setGlobalHandler((error, isFatal) => {\n        if (this.config.captureUncaught && this.config.shouldSend()) {\n          this.error(error, undefined, (queued) => {\n            if (previousHandler) {\n              previousHandler(error, isFatal);\n            }\n          });\n        } else if (previousHandler) {\n          previousHandler(error, isFatal);\n        }\n      });\n    }\n  }\n\n  captureUnhandledRejections = () => {\n    const tracking = require('promise/setimmediate/rejection-tracking');\n    const client = this;\n    tracking.enable({\n      allRejections: true,\n      onUnhandled: function(id, error) { client.error(error); },\n      onHandled: function() {}\n    });\n  }\n\n  log = (obj, extra, callback) => {\n    if (this.isNative && !this.config.shouldSend()) {\n      if (callback) {\n        callback(false);\n      }\n      return;\n    }\n\n    this.rollbar.log(obj, extra, callback);\n  }\n\n  debug = (obj, extra, callback) => {\n    return this.rollbar.debug(obj, extra, callback);\n  }\n\n  info = (obj, extra, callback) => {\n    return this.rollbar.info(obj, extra, callback);\n  }\n\n  warning = (obj, extra, callback) => {\n    return this.rollbar.warning(obj, extra, callback);\n  }\n\n  error = (obj, extra, callback) => {\n    return this.rollbar.error(obj, extra, callback);\n  }\n\n  critical = (obj, extra, callback) => {\n    return this.rollbar.critical(obj, extra, callback);\n  }\n\n  setPerson = (id, name, email) => {\n    this.rollbar.configure({}, {person: {id, name, email}});\n    if (NativeClient) {\n      NativeClient.setPerson({id, name, email});\n    }\n  }\n\n  clearPerson = () => {\n    this.rollbar.configure({}, {person: {}});\n    if (NativeClient) {\n      NativeClient.clearPerson();\n    }\n  }\n}\n\nclass Configuration {\n  constructor(options) {\n    const pkgData = require('../package.json');\n\n    // Ensure captureDeviceInfo is set before calling payloadOptions() below.\n    this.captureDeviceInfo = options.captureDeviceInfo === undefined ? false : options.captureDeviceInfo;\n\n    this.options = merge(options || {}, {\n      payload: merge(options.payload, this.payloadOptions()),\n      notifier: {\n        name: 'rollbar-react-native',\n        version: pkgData['version']\n      }\n    });\n  }\n\n  shouldSend = () => {\n    return !this.releaseStage ||\n      !this.enabledReleaseStages ||\n      this.enabledReleaseStages.includes(this.releaseStage);\n  }\n\n  setPlatform = (platform) => {\n    if (this.platform === undefined) {\n      this.platform = platform;\n    }\n  }\n\n  payloadOptions = () => {\n    if (!this.captureDeviceInfo) {\n      return {};\n    }\n\n    return {\n      client: {\n        os: this.deviceAttributes()\n      }\n    }\n  }\n\n  deviceAttributes = () => {\n    if (NativeClient) {\n      return JSON.parse(NativeClient.deviceAttributes());\n    } else {\n      return {};\n    }\n  }\n\n  toJSON = () => {\n    return merge(this.options, {\n      platform: this.platform\n    });\n  }\n}\n"],"mappings":"+EAAA,yCAEA,iFACA,yDAEA,8BAAgC,oOAEhC,GAAMA,aAAY,CAAGC,0BAAa,CAACC,kBAAkB,CAAC,GAEzCC,OAAM,CACjB,gBAAYC,MAAM,CAAE,kDAsBpBC,yBAAyB,CAAG,UAAM,CAChC,GAAI,KAAI,CAACC,QAAQ,EAAI,MAAOC,WAAU,GAAKC,SAAS,CAAE,CACpD,GAAMC,gBAAe,CAAGF,UAAU,CAACG,gBAAgB,EAAE,CAErDH,UAAU,CAACI,gBAAgB,CAAC,SAACC,KAAK,CAAEC,OAAO,CAAK,CAC9C,GAAI,KAAI,CAACT,MAAM,CAACU,eAAe,EAAI,KAAI,CAACV,MAAM,CAACW,UAAU,EAAE,CAAE,CAC3D,KAAI,CAACH,KAAK,CAACA,KAAK,CAAEJ,SAAS,CAAE,SAACQ,MAAM,CAAK,CACvC,GAAIP,eAAe,CAAE,CACnBA,eAAe,CAACG,KAAK,CAAEC,OAAO,CAAC,CACjC,CACF,CAAC,CAAC,CACJ,CAAC,IAAM,IAAIJ,eAAe,CAAE,CAC1BA,eAAe,CAACG,KAAK,CAAEC,OAAO,CAAC,CACjC,CACF,CAAC,CAAC,CACJ,CACF,CAAC,MAEDI,0BAA0B,CAAG,UAAM,CACjC,GAAMC,SAAQ,CAAGC,OAAO,CAAC,yCAAyC,CAAC,CACnE,GAAMC,OAAM,CAAG,KAAI,CACnBF,QAAQ,CAACG,MAAM,CAAC,CACdC,aAAa,CAAE,IAAI,CACnBC,WAAW,CAAE,qBAASC,EAAE,CAAEZ,KAAK,CAAE,CAAEQ,MAAM,CAACR,KAAK,CAACA,KAAK,CAAC,CAAE,CAAC,CACzDa,SAAS,CAAE,oBAAW,CAAC,CACzB,CAAC,CAAC,CACJ,CAAC,MAEDC,GAAG,CAAG,SAACC,GAAG,CAAEC,KAAK,CAAEC,QAAQ,CAAK,CAC9B,GAAI,KAAI,CAACvB,QAAQ,EAAI,CAAC,KAAI,CAACF,MAAM,CAACW,UAAU,EAAE,CAAE,CAC9C,GAAIc,QAAQ,CAAE,CACZA,QAAQ,CAAC,KAAK,CAAC,CACjB,CACA,OACF,CAEA,KAAI,CAACC,OAAO,CAACJ,GAAG,CAACC,GAAG,CAAEC,KAAK,CAAEC,QAAQ,CAAC,CACxC,CAAC,MAEDE,KAAK,CAAG,SAACJ,GAAG,CAAEC,KAAK,CAAEC,QAAQ,CAAK,CAChC,MAAO,MAAI,CAACC,OAAO,CAACC,KAAK,CAACJ,GAAG,CAAEC,KAAK,CAAEC,QAAQ,CAAC,CACjD,CAAC,MAEDG,IAAI,CAAG,SAACL,GAAG,CAAEC,KAAK,CAAEC,QAAQ,CAAK,CAC/B,MAAO,MAAI,CAACC,OAAO,CAACE,IAAI,CAACL,GAAG,CAAEC,KAAK,CAAEC,QAAQ,CAAC,CAChD,CAAC,MAEDI,OAAO,CAAG,SAACN,GAAG,CAAEC,KAAK,CAAEC,QAAQ,CAAK,CAClC,MAAO,MAAI,CAACC,OAAO,CAACG,OAAO,CAACN,GAAG,CAAEC,KAAK,CAAEC,QAAQ,CAAC,CACnD,CAAC,MAEDjB,KAAK,CAAG,SAACe,GAAG,CAAEC,KAAK,CAAEC,QAAQ,CAAK,CAChC,MAAO,MAAI,CAACC,OAAO,CAAClB,KAAK,CAACe,GAAG,CAAEC,KAAK,CAAEC,QAAQ,CAAC,CACjD,CAAC,MAEDK,QAAQ,CAAG,SAACP,GAAG,CAAEC,KAAK,CAAEC,QAAQ,CAAK,CACnC,MAAO,MAAI,CAACC,OAAO,CAACI,QAAQ,CAACP,GAAG,CAAEC,KAAK,CAAEC,QAAQ,CAAC,CACpD,CAAC,MAEDM,SAAS,CAAG,SAACX,EAAE,CAAEY,IAAI,CAAEC,KAAK,CAAK,CAC/B,KAAI,CAACP,OAAO,CAACQ,SAAS,CAAC,CAAC,CAAC,CAAE,CAACC,MAAM,CAAE,CAACf,EAAE,CAAFA,EAAE,CAAEY,IAAI,CAAJA,IAAI,CAAEC,KAAK,CAALA,KAAK,CAAC,CAAC,CAAC,CACvD,GAAIrC,YAAY,CAAE,CAChBA,YAAY,CAACmC,SAAS,CAAC,CAACX,EAAE,CAAFA,EAAE,CAAEY,IAAI,CAAJA,IAAI,CAAEC,KAAK,CAALA,KAAK,CAAC,CAAC,CAC3C,CACF,CAAC,MAEDG,WAAW,CAAG,UAAM,CAClB,KAAI,CAACV,OAAO,CAACQ,SAAS,CAAC,CAAC,CAAC,CAAE,CAACC,MAAM,CAAE,CAAC,CAAC,CAAC,CAAC,CACxC,GAAIvC,YAAY,CAAE,CAChBA,YAAY,CAACwC,WAAW,EAAE,CAC5B,CACF,CAAC,CA5FC,IAAI,CAAClC,QAAQ,CAAGmC,qBAAQ,CAACC,EAAE,GAAK,KAAK,CAErC,GAAI,IAAI,CAACpC,QAAQ,CAAE,CACjB,IAAI,CAACF,MAAM,CAAG,GAAIuC,cAAa,CAACvC,MAAM,CAAC,CACvC,IAAI,CAACA,MAAM,CAACwC,WAAW,CAACH,qBAAQ,CAACC,EAAE,CAAC,CAEpC,GAAI1C,YAAY,CAAE,CAChBA,YAAY,CAAC6C,IAAI,CAAC,IAAI,CAACzC,MAAM,CAAC0C,MAAM,EAAE,CAAC,CACzC,CAEA,IAAI,CAAChB,OAAO,CAAG,GAAIiB,iBAAkB,CAAC,IAAI,CAAC3C,MAAM,CAAC0C,MAAM,EAAE,CAAC,CAE3D,IAAI,CAACzC,yBAAyB,EAAE,CAChC,GAAI,IAAI,CAACD,MAAM,CAACa,0BAA0B,CAAE,CAC1C,IAAI,CAACA,0BAA0B,EAAE,CACnC,CACF,CAAC,IAAM,CACL,IAAI,CAACa,OAAO,CAAG,GAAIkB,kBAAc,CAAC5C,MAAM,CAAC,CAC3C,CACF,CAAC,0BA4EGuC,cAAa,CACjB,uBAAYM,OAAO,CAAE,0DAerBlC,UAAU,CAAG,UAAM,CACjB,MAAO,CAAC,MAAI,CAACmC,YAAY,EACvB,CAAC,MAAI,CAACC,oBAAoB,EAC1B,MAAI,CAACA,oBAAoB,CAACC,QAAQ,CAAC,MAAI,CAACF,YAAY,CAAC,CACzD,CAAC,MAEDN,WAAW,CAAG,SAACS,QAAQ,CAAK,CAC1B,GAAI,MAAI,CAACA,QAAQ,GAAK7C,SAAS,CAAE,CAC/B,MAAI,CAAC6C,QAAQ,CAAGA,QAAQ,CAC1B,CACF,CAAC,MAEDC,cAAc,CAAG,UAAM,CACrB,GAAI,CAAC,MAAI,CAACC,iBAAiB,CAAE,CAC3B,MAAO,CAAC,CAAC,CACX,CAEA,MAAO,CACLnC,MAAM,CAAE,CACNoC,EAAE,CAAE,MAAI,CAACC,gBAAgB,EAC3B,CACF,CAAC,CACH,CAAC,MAEDA,gBAAgB,CAAG,UAAM,CACvB,GAAIzD,YAAY,CAAE,CAChB,MAAO0D,KAAI,CAACC,KAAK,CAAC3D,YAAY,CAACyD,gBAAgB,EAAE,CAAC,CACpD,CAAC,IAAM,CACL,MAAO,CAAC,CAAC,CACX,CACF,CAAC,MAEDX,MAAM,CAAG,UAAM,CACb,MAAO,GAAAc,YAAK,EAAC,MAAI,CAACX,OAAO,CAAE,CACzBI,QAAQ,CAAE,MAAI,CAACA,QACjB,CAAC,CAAC,CACJ,CAAC,CAlDC,GAAMQ,QAAO,CAAG1C,OAAO,CAAC,iBAAiB,CAAC,CAG1C,IAAI,CAACoC,iBAAiB,CAAGN,OAAO,CAACM,iBAAiB,GAAK/C,SAAS,CAAG,KAAK,CAAGyC,OAAO,CAACM,iBAAiB,CAEpG,IAAI,CAACN,OAAO,CAAG,GAAAW,YAAK,EAACX,OAAO,EAAI,CAAC,CAAC,CAAE,CAClCa,OAAO,CAAE,GAAAF,YAAK,EAACX,OAAO,CAACa,OAAO,CAAE,IAAI,CAACR,cAAc,EAAE,CAAC,CACtDS,QAAQ,CAAE,CACR3B,IAAI,CAAE,sBAAsB,CAC5B4B,OAAO,CAAEH,OAAO,CAAC,SAAS,CAC5B,CACF,CAAC,CAAC,CACJ,CAAC"}